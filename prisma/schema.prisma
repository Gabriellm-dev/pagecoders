datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Usuario {
  cpf              String   @id
  email            String   @unique
  senha            String
  dataCadastro     DateTime @default(now())
  nome             String
  rua              String?
  numero           Int?
  bairro           String?
  cidade           String?
  estado           String?
  cep              String?
  livros           Livro[]
  emprestimos      Emprestimo[]
  classificacoes   ClassificacaoUsuario[]
}

model Livro {
  codigo            Int         @id @default(autoincrement())
  fkUsuarioCpf      String
  nome              String
  editora           String?
  dataPublicacao    DateTime?
  numEdicao         Int?
  autorEs           String?
  genero            String?
  disponivel        Boolean     @default(true)
  usuario           Usuario     @relation(fields: [fkUsuarioCpf], references: [cpf])
  emprestimos       Emprestimo[]
}

model Emprestimo {
  idEmprestimo          Int       @id @default(autoincrement())
  fkUsuarioCpf          String
  fkLivroCodigo         Int
  dataEmprestimo        DateTime  @default(now())
  dataPrevistaDevolucao DateTime?
  dataDevolucao         DateTime?
  emprestimoAutorizado  Boolean   @default(false)
  emprestimoSolicitado  Boolean   @default(true)
  usuario               Usuario   @relation(fields: [fkUsuarioCpf], references: [cpf])
  livro                 Livro     @relation(fields: [fkLivroCodigo], references: [codigo])
  avaliacaoEmprestimos  AvaliacaoEmprestimo[]
}

model AvaliacaoEmprestimo {
  codAvaliacao   Int     @id @default(autoincrement())
  fkEmprestimoId Int
  classifLivro   Int?
  classifUsuario Int?
  comentario     String?
  emprestimo     Emprestimo @relation(fields: [fkEmprestimoId], references: [idEmprestimo])
  classificacoes ClassificacaoUsuario[]
}

model ClassificacaoUsuario {
  fkUsuarioCpf   String
  fkAvaliacaoCod Int
  usuario        Usuario @relation(fields: [fkUsuarioCpf], references: [cpf])
  avaliacao      AvaliacaoEmprestimo @relation(fields: [fkAvaliacaoCod], references: [codAvaliacao])

  @@id([fkUsuarioCpf, fkAvaliacaoCod])
}
